<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>عقارك - منصة العقارات الرائدة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { 
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --rent-color: #9b59b6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .logo i {
            margin-left: 10px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin: 0 15px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        nav ul li a:hover {
            color: var(--light-color);
        }
        
        .auth-buttons button {
            background-color: white;
            color: var(--primary-color);
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .auth-buttons button:hover {
            background-color: var(--light-color);
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info span {
            margin-left: 10px;
        }
        
        .user-info button {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .user-info button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Breadcrumb */
        .breadcrumb {
            padding: 15px 0;
            background-color: #f8f9fa;
            margin-bottom: 20px;
        }
        
        .breadcrumb ul {
            display: flex;
            list-style: none;
        }
        
        .breadcrumb li {
            margin-left: 10px;
            color: #6c757d;
        }
        
        .breadcrumb li:not(:last-child)::after {
            content: "/";
            margin-right: 10px;
        }
        
        .breadcrumb a {
            color: var(--secondary-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        /* Home Page */
        .home-page {
            display: none;
        }
        
        .hero-section {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 100px 0;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 40px;
        }
        
        .hero-content h1 {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .hero-content p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .search-form {
            display: flex;
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 50px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .search-form input {
            flex: 1;
            border: none;
            padding: 15px 20px;
            font-size: 1rem;
            outline: none;
        }
        
        .search-form button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 0 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .search-form button:hover {
            background: var(--primary-color);
        }
        
        .section-title {
            font-size: 2.5rem;
            color: var(--dark-color);
            margin: 40px 0 20px;
            text-align: center;
        }
        
        .section-subtitle {
            text-align: center;
            color: #777;
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .category-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .category-tab {
            padding: 10px 25px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 50px;
            margin: 0 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .category-tab.active {
            background: var(--secondary-color);
            color: white;
            border-color: var(--secondary-color);
        }
        
        /* Properties Listing */
        .properties-listing {
            display: none;
        }
        
        .rent-listing {
            display: none;
        }
        
        .favorites-page {
            display: none;
        }
        
        .page-title {
            font-size: 2.8rem;
            color: var(--dark-color);
            margin: 20px 0;
            text-align: center;
        }
        
        .page-search {
            margin-bottom: 30px;
        }
        
        .page-search-form {
            display: flex;
            max-width: 700px;
            margin: 0 auto;
            background: white;
            border-radius: 50px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .page-search-form input {
            flex: 1;
            border: none;
            padding: 15px 20px;
            font-size: 1rem;
            outline: none;
        }
        
        .page-search-form button {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 0 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .page-search-form button:hover {
            background: var(--primary-color);
        }
        
        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        
        .property-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .property-card:hover {
            transform: translateY(-5px);
        }
        
        .property-image {
            height: 200px;
            position: relative;
        }
        
        .property-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .property-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .badge-sale {
            background: var(--accent-color);
        }
        
        .badge-rent {
            background: var(--rent-color);
        }
        
        .property-content {
            padding: 20px;
        }
        
        .property-card-title {
            font-size: 1.3rem;
            color: var(--dark-color);
            margin-bottom: 10px;
        }
        
        .property-card-price {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .price-sale {
            color: var(--accent-color);
        }
        
        .price-rent {
            color: var(--rent-color);
        }
        
        .property-card-address {
            color: #777;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .property-card-address i {
            margin-left: 8px;
        }
        
        .property-card-features {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .property-feature {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .property-feature i {
            color: var(--secondary-color);
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .property-feature span {
            font-size: 0.9rem;
        }
        
        .view-details-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background: var(--secondary-color);
            color: white;
            text-align: center;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .view-details-btn:hover {
            background: var(--primary-color);
        }
        
        /* Property Details */
        .property-detail {
            display: none;
            margin: 30px 0;
        }
        
        .property-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .property-title {
            font-size: 2rem;
            color: var(--dark-color);
        }
        
        .property-price {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .price-sale-detail {
            color: var(--accent-color);
        }
        
        .price-rent-detail {
            color: var(--rent-color);
        }
        
        .property-address {
            color: #777;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .property-address i {
            margin-left: 8px;
        }
        
        /* Gallery */
        .property-gallery {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
            height: 400px;
        }
        
        .main-image {
            border-radius: 8px;
            overflow: hidden;
            height: 100%;
            position: relative;
        }
        
        .main-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .badge-sale-detail {
            background: var(--accent-color);
        }
        
        .badge-rent-detail {
            background: var(--rent-color);
        }
        
        .thumbnails {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
        }
        
        .thumbnail {
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }
        
        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .thumbnail:hover .thumbnail-overlay {
            opacity: 1;
        }
        
        /* Property Content */
        .property-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            align-items: start;
        }
        
        /* Details Section */
        .details-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 2rem;
            color: var(--dark-color);
            margin-top: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        .property-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .feature {
            display: flex;
            align-items: center;
        }
        
        .feature i {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-left: 10px;
        }
        
        .feature div {
            display: flex;
            flex-direction: column;
        }
        
        .feature-value {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .feature-label {
            color: #777;
            font-size: 0.9rem;
        }
        
        .property-description {
            line-height: 1.8;
            color: #555;
        }
        
        /* Amenities */
        .amenities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .amenity {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .amenity i {
            color: var(--success-color);
            margin-left: 10px;
        }
        
        /* Owner Info */
        .owner-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .owner-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .owner-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            margin-left: 15px;
            border: 3px solid var(--secondary-color);
            flex-shrink: 0;
        }
        
        .owner-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .owner-details {
            flex-grow: 1;
        }
        
        .owner-details h3 {
            margin-bottom: 5px;
            font-size: 1.2rem;
        }
        
        .owner-details p {
            color: #777;
            margin: 0;
        }
        
        .contact-info {
            margin-top: 20px;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        
        .contact-item i {
            width: 30px;
            color: var(--secondary-color);
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .phone-number {
            font-weight: bold;
            color: var(--dark-color);
            transition: filter 0.3s ease;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            margin: 10px 0;
        }
        
        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-color);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--secondary-color);
            color: var(--secondary-color);
        }
        
        .btn-outline:hover {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-whatsapp {
            background: #25D366;
            color: white;
        }
        
        .btn-whatsapp:hover {
            background: #128C7E;
        }
        
        /* Map Section */
        .map-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            height: 400px;
        }
        
        #property-map {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
        
        /* Contact Page */
        .contact-page {
            display: none;
            margin: 30px 0;
        }
        
        .contact-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .contact-info-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }
        
        .contact-form-section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .contact-info-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .contact-info-item i {
            font-size: 1.5rem;
            color: var(--secondary-color);
            margin-left: 15px;
            margin-top: 5px;
            flex-shrink: 0;
        }
        
        .contact-info-content {
            flex-grow: 1;
        }
        
        .contact-info-content h3 {
            margin-bottom: 5px;
            font-size: 1.2rem;
        }
        
        .contact-info-content p {
            color: #777;
            line-height: 1.6;
            margin: 0;
        }
        
        .social-links {
            display: flex;
            margin-top: 20px;
        }
        
        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            margin-left: 10px;
            transition: all 0.3s ease;
        }
        
        .social-links a:hover {
            background: var(--primary-color);
            transform: translateY(-3px);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* Search Results */
        .search-results {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: none;
        }
        
        .search-results-title {
            font-size: 1.5rem;
            color: var(--dark-color);
            margin-bottom: 15px;
        }
        
        .no-results {
            text-align: center;
            padding: 30px;
            color: #777;
        }
        
        .no-results i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 15px;
        }
        
        /* Footer */
        footer {
            background: var(--dark-color);
            color: white;
            padding: 40px 0 20px;
            margin-top: 50px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }
        
        .footer-section h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        
        .footer-section ul {
            list-style: none;
        }
        
        .footer-section ul li {
            margin: 10px 0;
        }
        
        .footer-section a {
            color: #ddd;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .footer-section a:hover {
            color: white;
            text-decoration: underline;
        }
        
        .footer-bottom {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #4a5568;
        }
        
        /* Back Button */
        .back-button {
            display: inline-flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 8px 15px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .back-button:hover {
            background: var(--primary-color);
        }
        
        .back-button i {
            margin-right: 8px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        
        .action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .action-btn i {
            margin-left: 8px;
        }
        
        .btn-favorite {
            background: #fff;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        .btn-favorite:hover {
            background: #e74c3c;
            color: white;
        }
        
        .btn-favorite.active {
            background: #e74c3c;
            color: white;
        }
        
        .btn-favorite.active:hover {
            background: #c0392b;
        }
        
        .btn-share {
            background: #fff;
            color: #3498db;
            border: 1px solid #3498db;
        }
        
        .btn-share:hover {
            background: #3498db;
            color: white;
        }
        
        .btn-print {
            background: #fff;
            color: #777;
            border: 1px solid #777;
        }
        
        .btn-print:hover {
            background: #777;
            color: white;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .property-gallery {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .thumbnails {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: 1fr;
                height: 120px;
            }
            
            .property-content {
                grid-template-columns: 1fr;
            }
            
            .properties-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .contact-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin: 15px 0;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .property-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .property-price {
                margin-top: 15px;
            }
            
            .property-features {
                grid-template-columns: 1fr 1fr;
            }
            
            .amenities {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .hero-content h1 {
                font-size: 2rem;
            }
            
            .search-form, .page-search-form {
                flex-direction: column;
                border-radius: 8px;
            }
            
            .search-form input, .page-search-form input {
                border-radius: 8px 8px 0 0;
            }
            
            .search-form button, .page-search-form button {
                border-radius: 0 0 8px 8px;
                padding: 15px;
            }
            
            .category-tabs {
                flex-wrap: wrap;
            }
            
            .owner-info {
                flex-direction: column;
                text-align: center;
            }
            
            .owner-avatar {
                margin-left: 0;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo" onclick="showHomePage()">
                <i class="fas fa-building"></i>
                <span>عقارك</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#" onclick="showHomePage(); return false;">الرئيسية</a></li>
                    <li><a href="#" onclick="showPropertiesListing(); return false;">عقارات للبيع</a></li>
                    <li><a href="#" onclick="showRentListing(); return false;">عقارات للإيجار</a></li>
                    <li><a href="#" onclick="showFavorites(); return false;">عقاراتي المفضلة</a></li>
                    <li><a href="#">وكلاء عقاريون</a></li>
                    <li><a href="#" onclick="showContactPage(); return false;">اتصل بنا</a></li>
                </ul>
            </nav>
            <div class="auth-buttons" id="auth-buttons">
                <button onclick="showModal('login-modal')">تسجيل الدخول</button>
                <button onclick="showModal('register-modal')">إنشاء حساب</button>
            </div>
            <div class="user-info" id="user-info" style="display: none;">
                <span id="user-name">مرحباً</span>
                <button onclick="logout()">تسجيل الخروج</button>
            </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <div class="container">
            <ul id="breadcrumb-list">
                <li><a onclick="showHomePage()">الرئيسية</a></li>
            </ul>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="container">
        <!-- Home Page -->
        <div id="home-page" class="home-page">
            <!-- Hero Section -->
            <div class="hero-section">
                <div class="hero-content">
                    <h1>منصتك الموثوقة للعقارات</h1>
                    <p>ابحث عن عقار أحلامك من بين آلاف الخيارات المتاحة للبيع والإيجار في جميع أنحاء المملكة</p>
                    <div class="search-form">
                        <input type="text" id="search-input" placeholder="ابحث عن مدينة، حي، أو نوع عقار...">
                        <button onclick="performSearch()"><i class="fas fa-search"></i> بحث</button>
                    </div>
                </div>
            </div>
            
            <!-- Search Results -->
            <div id="search-results" class="search-results">
                <h2 class="search-results-title">نتائج البحث</h2>
                <div id="search-results-container"></div>
            </div>
            
            <!-- Featured Properties Section -->
            <h2 class="section-title">عقارات مميزة</h2>
            <p class="section-subtitle">استعرض أحدث العقارات المضافة إلى منصتنا</p>
            
            <div class="category-tabs">
                <div class="category-tab active" onclick="filterProperties('all')">الكل</div>
                <div class="category-tab" onclick="filterProperties('sale')">للبيع</div>
                <div class="category-tab" onclick="filterProperties('rent')">للإيجار</div>
            </div>
            
            <!-- Properties Grid -->
            <div class="properties-grid" id="home-properties-grid">
                <!-- Property cards will be dynamically loaded here -->
            </div>
            
            <!-- Call to Action -->
            <div style="text-align: center; margin: 50px 0;">
                <h2 style="font-size: 2rem; margin-bottom: 20px;">لم تجد ما تبحث عنه؟</h2>
                <p style="margin-bottom: 30px; color: #777;">تصفح المزيد من العقارات أو سجل إشعارًا للعقارات الجديدة</p>
                <div style="display: flex; justify-content: center; gap: 15px;">
                    <button class="btn btn-primary" style="display: inline-block; width: auto; padding: 12px 25px;" onclick="showPropertiesListing()">
                        <i class="fas fa-home"></i> عقارات للبيع
                    </button>
                    <button class="btn btn-outline" style="display: inline-block; width: auto; padding: 12px 25px;" onclick="showRentListing()">
                        <i class="fas fa-key"></i> عقارات للإيجار
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Properties Listing Page -->
        <div id="properties-listing" class="properties-listing">
            <h1 class="page-title">عقارات للبيع</h1>
            
            <!-- Page Search -->
            <div class="page-search">
                <div class="page-search-form">
                    <input type="text" id="sale-search-input" placeholder="ابحث عن مدينة، حي، أو نوع عقار...">
                    <button onclick="performSaleSearch()"><i class="fas fa-search"></i> بحث</button>
                </div>
            </div>
            
            <!-- Search Results -->
            <div id="sale-search-results" class="search-results">
                <h2 class="search-results-title">نتائج البحث</h2>
                <div id="sale-search-results-container"></div>
            </div>
            
            <!-- Properties Grid -->
            <div class="properties-grid" id="sale-properties-grid">
                <!-- Property cards will be dynamically loaded here -->
            </div>
        </div>
        
        <!-- Rent Properties Listing Page -->
        <div id="rent-listing" class="rent-listing">
            <h1 class="page-title">عقارات للإيجار</h1>
            
            <!-- Page Search -->
            <div class="page-search">
                <div class="page-search-form">
                    <input type="text" id="rent-search-input" placeholder="ابحث عن مدينة، حي، أو نوع عقار...">
                    <button onclick="performRentSearch()"><i class="fas fa-search"></i> بحث</button>
                </div>
            </div>
            
            <!-- Search Results -->
            <div id="rent-search-results" class="search-results">
                <h2 class="search-results-title">نتائج البحث</h2>
                <div id="rent-search-results-container"></div>
            </div>
            
            <!-- Properties Grid -->
            <div class="properties-grid" id="rent-properties-grid">
                <!-- Property cards will be dynamically loaded here -->
            </div>
        </div>
        
        <!-- Favorites Page -->
        <div id="favorites-page" class="favorites-page">
            <h1 class="page-title">عقاراتي المفضلة</h1>
            <div class="properties-grid" id="favorites-grid">
                <!-- Favorite properties will be loaded here -->
            </div>
        </div>
        
        <!-- Property Details Page -->
        <div id="property-detail" class="property-detail">
            <button class="back-button" onclick="goBackToListing()">
                <i class="fas fa-arrow-right"></i> العودة إلى القائمة
            </button>
            
            <div class="property-header">
                <h1 class="property-title" id="detail-title">فيلا فاخرة للبيع في حي الروضة</h1>
                <div class="property-price" id="detail-price">1,250,000 ريال</div>
            </div>
            
            <div class="property-address">
                <i class="fas fa-map-marker-alt"></i>
                <span id="detail-address">حي الروضة، الرياض، المملكة العربية السعودية</span>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn btn-favorite" id="detail-favorite-btn">
                    <i class="fas fa-heart"></i> حفظ العقار
                </button>
                <button class="action-btn btn-share">
                    <i class="fas fa-share-alt"></i> مشاركة
                </button>
                <button class="action-btn btn-print">
                    <i class="fas fa-print"></i> طباعة
                </button>
            </div>
            
            <!-- Gallery -->
            <div class="property-gallery">
                <div class="main-image">
                    <img src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1176&q=80" alt="فيلا فاخرة" id="main-image">
                    <div class="image-badge" id="detail-badge">للبيع</div>
                </div>
                <div class="thumbnails">
                    <div class="thumbnail" onclick="changeImage('https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1176&q=80')">
                        <img src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1176&q=80" alt="صورة خارجية">
                        <div class="thumbnail-overlay">
                            <i class="fas fa-search-plus"></i>
                        </div>
                    </div>
                    <div class="thumbnail" onclick="changeImage('https://images.unsplash.com/photo-1600566753052-d6f4e67238e1?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80')">
                        <img src="https://images.unsplash.com/photo-1600566753052-d6f4e67238e1?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80" alt="صورة الصالة">
                        <div class="thumbnail-overlay">
                            <i class="fas fa-search-plus"></i>
                        </div>
                    </div>
                    <div class="thumbnail" onclick="changeImage('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80')">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80" alt="صورة المطبخ">
                        <div class="thumbnail-overlay">
                            <i class="fas fa-search-plus"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Property Content -->
            <div class="property-content">
                <!-- Left Column -->
                <div>
                    <!-- Details Section -->
                    <div class="details-section">
                        <h2 class="section-title">تفاصيل العقار</h2>
                        
                        <div class="property-features">
                            <div class="feature">
                                <i class="fas fa-ruler-combined"></i>
                                <div>
                                    <span class="feature-value">320 م²</span>
                                    <span class="feature-label">المساحة</span>
                                </div>
                            </div>
                            <div class="feature">
                                <i class="fas fa-bed"></i>
                                <div>
                                    <span class="feature-value">4</span>
                                    <span class="feature-label">غرف نوم</span>
                                </div>
                            </div>
                            <div class="feature">
                                <i class="fas fa-bath"></i>
                                <div>
                                    <span class="feature-value">3</span>
                                    <span class="feature-label">حمامات</span>
                                </div>
                            </div>
                            <div class="feature">
                                <i class="fas fa-car"></i>
                                <div>
                                    <span class="feature-value">2</span>
                                    <span class="feature-label">مواقف سيارات</span>
                                </div>
                            </div>
                            <div class="feature">
                                <i class="fas fa-building"></i>
                                <div>
                                    <span class="feature-value">دورين</span>
                                    <span class="feature-label">عدد الأدوار</span>
                                </div>
                            </div>
                            <div class="feature">
                                <i class="fas fa-calendar-alt"></i>
                                <div>
                                    <span class="feature-value">2022</span>
                                    <span class="feature-label">سنة البناء</span>
                                </div>
                            </div>
                        </div>
                        
                        <h3 class="section-title">الوصف</h3>
                        <p class="property-description" id="detail-description">
                            فيلا فاخرة للبيع في حي الروضة، مساحة الأرض 320 متر مربع، مكونة من دورين، تحتوي على 4 غرف نوم و3 حمامات وصالة كبيرة ومطبخ مجهز بأحدث الأجهزة. الفيلا تتميز بتصميمها العصري وتشطيبها الفاخر، وتطل على شارع رئيسي مع موقفين للسيارات. الموقع ممتاز وقريب من الخدمات والمرافق العامة مثل المدارس والمستشفيات والمراكز التجارية.
                        </p>
                        
                        <h3 class="section-title">المرافق المتوفرة</h3>
                        <div class="amenities">
                            <div class="amenity">
                                <i class="fas fa-check-circle"></i>
                                <span>تكييف مركزي</span>
                            </div>
                            <div class="amenity">
                                <i class="fas fa-check-circle"></i>
                                <span>نظام إنذار ضد الحريق</span>
                            </div>
                            <div class="amenity">
                                <i class="fas fa-check-circle"></i>
                                <span>أنظمة أمنية</span>
                            </div>
                            <div class="amenity">
                                <i class="fas fa-check-circle"></i>
                                <span>خزانات</span>
                            </div>
                            <div class="amenity">
                                <i class="fas fa-check-circle"></i>
                                <span>سخانات مياه</span>
                            </div>
                            <div class="amenity">
                                <i class="fas fa-check-circle"></i>
                                <span>حديقة خاصة</span>
                            </div>
                            <div class="amenity">
                                <i class="fas fa-check-circle"></i>
                                <span>مواقف سيارات</span>
                            </div>
                            <div class="amenity">
                                <i class="fas fa-check-circle"></i>
                                <span>غرفة خادمة</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Map Section -->
                    <div class="map-section">
                        <h2 class="section-title">الموقع</h2>
                        <div id="property-map"></div>
                    </div>
                </div>
                
                <!-- Right Column -->
                <div>
                    <!-- Owner Section -->
                    <div class="owner-section" style="margin-top:190px;">
                        <h2 class="section-title">معلومات المالك</h2>
                        
                        <div class="owner-info">
                            <div class="owner-avatar">
                                <img src="https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80" alt="صورة المالك" id="owner-avatar-img">
                            </div>
                            <div class="owner-details">
                                <h3 id="owner-name">محمد أحمد</h3>
                                <p>عضو منذ 2020</p>
                            </div>
                        </div>
                        
                        <div class="contact-info">
                            <div class="contact-item">
                                <i class="fas fa-phone"></i>
                                <span class="phone-number" id="owner-phone">+966 55 123 4567</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-envelope"></i>
                                <span id="owner-email">mohamed.ahmed@example.com</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="openContactModal()">
                            <i class="fas fa-envelope"></i> إرسال رسالة
                        </button>
                        <button class="btn btn-whatsapp">
                            <i class="fab fa-whatsapp"></i> التواصل عبر واتساب
                        </button>
                        <button class="btn btn-outline" onclick="showPhoneNumber()">
                            <i class="fas fa-phone"></i> عرض رقم الهاتف
                        </button>
                    </div>
                    
                    <!-- Contact Form Modal -->
                    <div id="contact-modal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2>إرسال رسالة إلى المالك</h2>
                                <span class="close-modal" onclick="closeContactModal()">&times;</span>
                            </div>
                            <form>
                                <div class="form-group">
                                    <label>اسمك</label>
                                    <input type="text" required>
                                </div>
                                <div class="form-group">
                                    <label>بريدك الإلكتروني</label>
                                    <input type="email" required>
                                </div>
                                <div class="form-group">
                                    <label>رقم هاتفك</label>
                                    <input type="tel">
                                </div>
                                <div class="form-group">
                                    <label>رسالتك</label>
                                    <textarea placeholder="أهتم بالعقار وأرغب في معرفة المزيد من التفاصيل..." required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">إرسال الرسالة</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Contact Page -->
        <div id="contact-page" class="contact-page">
            <h1 class="page-title">اتصل بنا</h1>
            
            <div class="contact-container">
                <!-- Contact Information Section -->
                <div class="contact-info-section">
                    <h2 class="section-title">معلومات الاتصال</h2>
                    
                    <div class="contact-info-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div class="contact-info-content">
                            <h3>العنوان</h3>
                            <p>شارع الملك فهد، حي النخيل<br>الرياض، المملكة العربية السعودية</p>
                        </div>
                    </div>
                    
                    <div class="contact-info-item">
                        <i class="fas fa-phone"></i>
                        <div class="contact-info-content">
                            <h3>الهاتف</h3>
                            <p>+966 11 234 5678<br>+966 920 000 123</p>
                        </div>
                    </div>
                    
                    <div class="contact-info-item">
                        <i class="fas fa-envelope"></i>
                        <div class="contact-info-content">
                            <h3>البريد الإلكتروني</h3>
                            <p>info@aqarak.com<br>support@aqarak.com</p>
                        </div>
                    </div>
                    
                    <div class="contact-info-item">
                        <i class="fas fa-clock"></i>
                        <div class="contact-info-content">
                            <h3>ساعات العمل</h3>
                            <p>الأحد - الخميس: 8:00 ص - 6:00 م<br>الجمعة - السبت: 10:00 ص - 4:00 م</p>
                        </div>
                    </div>
                    
                    <h3 class="section-title">تابعنا على وسائل التواصل</h3>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <!-- Contact Form Section -->
                <div class="contact-form-section">
                    <h2 class="section-title">إرسال رسالة</h2>
                    
                    <form>
                        <div class="form-group">
                            <label>الاسم الكامل</label>
                            <input type="text" required>
                        </div>
                        
                        <div class="form-group">
                            <label>البريد الإلكتروني</label>
                            <input type="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label>رقم الهاتف</label>
                            <input type="tel" required>
                        </div>
                        
                        <div class="form-group">
                            <label>نوع الرسالة</label>
                            <select>
                                <option value="general">استفسار عام</option>
                                <option value="support">دعم فني</option>
                                <option value="partnership">شراكة</option>
                                <option value="complaint">شكوى</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>الرسالة</label>
                            <textarea placeholder="اكتب رسالتك هنا..." required></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">إرسال الرسالة</button>
                    </form>
                </div>
            </div>
            
            <!-- Map Section -->
            <div class="map-section">
                <h2 class="section-title">موقعنا على الخريطة</h2>
                <div id="contact-map"></div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>عن عقارك</h3>
                    <p>منصة عقارية رائدة تهدف إلى تسهيل عملية buying وبيع وتأجير العقارات في المملكة العربية السعودية.</p>
                </div>
                
                <div class="footer-section">
                    <h3>روابط سريعة</h3>
                    <ul>
                        <li><a href="#" onclick="showHomePage(); return false;">الرئيسية</a></li>
                        <li><a href="#" onclick="showPropertiesListing(); return false;">عقارات للبيع</a></li>
                        <li><a href="#" onclick="showRentListing(); return false;">عقارات للإيجار</a></li>
                        <li><a href="#">وكلاء عقاريون</a></li>
                        <li><a href="#" onclick="showContactPage(); return false;">اتصل بنا</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>وسائل التواصل</h3>
                    <ul>
                        <li><a href="#"><i class="fas fa-phone"></i> 920000000</a></li>
                        <li><a href="#"><i class="fas fa-envelope"></i> info@aqarak.com</a></li>
                        <li><a href="#"><i class="fab fa-twitter"></i> twitter.com/aqarak</a></li>
                        <li><a href="#"><i class="fab fa-instagram"></i> instagram.com/aqarak</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2023 عقارك. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>تسجيل الدخول</h2>
                <span class="close-modal" onclick="closeModal('login-modal')">&times;</span>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label>كلمة المرور</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn btn-primary">دخول</button>
                <p style="text-align: center; margin-top: 15px;">
                    ليس لديك حساب؟ <a href="#" onclick="showModal('register-modal'); closeModal('login-modal')">إنشاء حساب</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>إنشاء حساب جديد</h2>
                <span class="close-modal" onclick="closeModal('register-modal')">&times;</span>
            </div>
            <form id="register-form">
                <div class="form-group">
                    <label>الاسم الكامل</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label>البريد الإلكتروني</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label>كلمة المرور</label>
                    <input type="password" id="register-password" required>
                </div>
                <div class="form-group">
                    <label>تأكيد كلمة المرور</label>
                    <input type="password" id="register-password-confirm" required>
                </div>
                <button type="submit" class="btn btn-primary">إنشاء حساب</button>
                <p style="text-align: center; margin-top: 15px;">
                    لديك حساب بالفعل؟ <a href="#" onclick="showModal('login-modal'); closeModal('register-modal')">تسجيل الدخول</a>
                </p>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7"></script>
    <script>
        // Initialize Supabase with updated configuration
        const supabaseUrl = 'https://oanuujxhmxngstijciie.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9hbnV1anhobXhuZ3N0aWpjaWllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0NDc2NjAsImV4cCI6MjA3NDAyMzY2MH0.kiv8JpUxtTdDwDJTsMoDTb2vYNWbQMH19lzfYv7Xdzs';
        
        // Create a single Supabase client instance
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // Track current listing type
        let currentListingType = 'sale';
        let phoneNumberVisible = false;
        let currentPropertyId = null;
        let currentUser = null;
        
        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Check if user is already logged in
        async function checkUserSession() {
            const { data: { session }, error } = await supabase.auth.getSession();
            
            if (session) {
                // User is logged in
                currentUser = session.user;
                document.getElementById('auth-buttons').style.display = 'none';
                document.getElementById('user-info').style.display = 'flex';
                document.getElementById('user-name').textContent = `مرحباً، ${currentUser.email}`;
                
                // Ensure user has a profile
                await ensureUserProfile(currentUser);
            }
        }
        
        // Function to ensure user has a profile
        async function ensureUserProfile(user) {
            try {
                // Check if profile exists
                const { data: profile, error: profileError } = await supabase
                    .from('profiles')
                    .select('id')
                    .eq('id', user.id)
                    .single();
                
                // If profile doesn't exist, create it
                if (profileError && profileError.code === 'PGRST116') {
                    const { error: insertError } = await supabase
                        .from('profiles')
                        .insert([
                            { 
                                id: user.id, 
                                full_name: user.user_metadata?.full_name || user.email?.split('@')[0] || 'مستخدم', 
                                email: user.email 
                            }
                        ]);
                    
                    if (insertError) {
                        console.error('Error creating profile:', insertError);
                    }
                }
            } catch (err) {
                console.error('Error ensuring user profile:', err);
            }
        }
        
        // Function to resend confirmation email
        async function resendConfirmationEmail(email) {
            try {
                const { error } = await supabase.auth.resend({
                    type: 'signup',
                    email: email,
                });
                
                if (error) {
                    console.error('Error resending confirmation email:', error);
                    return false;
                }
                
                return true;
            } catch (err) {
                console.error('Error:', err);
                return false;
            }
        }
        
        // Registration function
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-password-confirm').value;
            
            if (password !== confirmPassword) {
                alert('كلمتا المرور غير متطابقتين');
                return;
            }
            
            try {
                // Register user
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            full_name: name
                        }
                    }
                });
                
                if (error) {
                    alert('خطأ في التسجيل: ' + error.message);
                    return;
                }
                
                // Create user profile in the database
                if (data.user) {
                    const { error: profileError } = await supabase
                        .from('profiles')
                        .insert([
                            { 
                                id: data.user.id, 
                                full_name: name, 
                                email: email 
                            }
                        ]);
                        
                    if (profileError) {
                        console.error('Error creating profile:', profileError);
                    }
                }
                
                alert('تم إنشاء الحساب بنجاح! يرجى تفعيل حسابك عبر البريد الإلكتروني.');
                closeModal('register-modal');
                document.getElementById('register-form').reset();
            } catch (err) {
                alert('حدث خطأ: ' + err.message);
            }
        });

        // Login function
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) {
                    if (error.message === "Email not confirmed") {
                        // Email not confirmed, show option to resend confirmation email
                        const resendOption = confirm("بريدك الإلكتروني لم يتم تأكيده بعد. هل ترغب في إعادة إرسال رسالة التأكيد؟");
                        if (resendOption) {
                            const success = await resendConfirmationEmail(email);
                            if (success) {
                                alert("تم إعادة إرسال رسالة التأكيد إلى بريدك الإلكتروني. يرجى التحقق من بريدك الوارد.");
                            } else {
                                alert("حدث خطأ أثناء إعادة إرسال رسالة التأكيد. يرجى المحاولة مرة أخرى لاحقاً.");
                            }
                        }
                        return;
                    } else {
                        alert('خطأ في تسجيل الدخول: ' + error.message);
                        return;
                    }
                }
                
                // Check if email is confirmed
                if (data.user && !data.user.email_confirmed_at) {
                    const resendOption = confirm("بريدك الإلكتروني لم يتم تأكيده بعد. هل ترغب في إعادة إرسال رسالة التأكيد؟");
                    if (resendOption) {
                        const success = await resendConfirmationEmail(email);
                        if (success) {
                            alert("تم إعادة إرسال رسالة التأكيد إلى بريدك الإلكتروني. يرجى التحقق من بريدك الوارد.");
                        } else {
                            alert("حدث خطأ أثناء إعادة إرسال رسالة التأكيد. يرجى المحاولة مرة أخرى لاحقاً.");
                        }
                    }
                    return;
                }
                
                // Update UI
                currentUser = data.user;
                document.getElementById('auth-buttons').style.display = 'none';
                document.getElementById('user-info').style.display = 'flex';
                document.getElementById('user-name').textContent = `مرحباً، ${currentUser.email}`;
                
                // Ensure user has a profile
                await ensureUserProfile(currentUser);
                
                closeModal('login-modal');
                document.getElementById('login-form').reset();
            } catch (err) {
                alert('حدث خطأ: ' + err.message);
            }
        });

        // Logout function
        async function logout() {
            try {
                const { error } = await supabase.auth.signOut();
                
                if (error) {
                    alert('خطأ في تسجيل الخروج: ' + error.message);
                    return;
                }
                
                // Update UI
                currentUser = null;
                document.getElementById('auth-buttons').style.display = 'flex';
                document.getElementById('user-info').style.display = 'none';
                
                alert('تم تسجيل الخروج بنجاح');
            } catch (err) {
                alert('حدث خطأ: ' + err.message);
            }
        }
        
        // Function to add property to favorites
        async function addToFavorites(propertyId) {
            // Check if user is logged in
            if (!currentUser) {
                alert('يرجى تسجيل الدخول لحفظ العقارات المفضلة');
                showModal('login-modal');
                return;
            }
            
            try {
                // Ensure user has a profile before adding to favorites
                await ensureUserProfile(currentUser);
                
                const { error } = await supabase
                    .from('favorites')
                    .insert([
                        { user_id: currentUser.id, property_id: propertyId }
                    ]);
                    
                if (error) {
                    // Check if it's a duplicate entry
                    if (error.code === '23505') {
                        alert('العقار موجود بالفعل في قائمتك المفضلة');
                    } else {
                        console.error('Error adding to favorites:', error);
                        alert('خطأ في إضافة العقار للمفضلة: ' + error.message);
                    }
                    return;
                }
                
                alert('تم إضافة العقار إلى قائمتك المفضلة');
                updateFavoriteButton(propertyId, true);
            } catch (err) {
                console.error('Error in addToFavorites:', err);
                alert('حدث خطأ: ' + err.message);
            }
        }

        // Function to remove property from favorites
        async function removeFromFavorites(propertyId) {
            // Check if user is logged in
            if (!currentUser) {
                return;
            }
            
            try {
                const { error } = await supabase
                    .from('favorites')
                    .delete()
                    .eq('user_id', currentUser.id)
                    .eq('property_id', propertyId);
                    
                if (error) {
                    alert('خطأ في إزالة العقار من المفضلة: ' + error.message);
                    return;
                }
                
                alert('تم إزالة العقار من قائمتك المفضلة');
                updateFavoriteButton(propertyId, false);
            } catch (err) {
                alert('حدث خطأ: ' + err.message);
            }
        }

        // Function to check if property is in user's favorites
        async function checkIfFavorite(propertyId) {
            if (!currentUser) {
                return false;
            }
            
            try {
                const { data, error } = await supabase
                    .from('favorites')
                    .select('id')
                    .eq('user_id', currentUser.id)
                    .eq('property_id', propertyId)
                    .maybeSingle(); // Use maybeSingle instead of single to avoid error if not found
                    
                if (error) {
                    console.error('Error checking favorite:', error);
                    return false;
                }
                
                return !!data;
            } catch (err) {
                console.error('Error:', err);
                return false;
            }
        }

        // Function to update favorite button state
        function updateFavoriteButton(propertyId, isFavorite) {
            const favoriteButtons = document.querySelectorAll(`[data-property-id="${propertyId}"] .btn-favorite`);
            const detailFavoriteBtn = document.getElementById('detail-favorite-btn');
            
            favoriteButtons.forEach(button => {
                if (isFavorite) {
                    button.innerHTML = '<i class="fas fa-heart"></i> إزالة من المفضلة';
                    button.classList.add('active');
                    button.onclick = () => removeFromFavorites(propertyId);
                } else {
                    button.innerHTML = '<i class="fas fa-heart"></i> حفظ العقار';
                    button.classList.remove('active');
                    button.onclick = () => addToFavorites(propertyId);
                }
            });
            
            // Update detail page button if it exists
            if (detailFavoriteBtn && currentPropertyId === propertyId) {
                if (isFavorite) {
                    detailFavoriteBtn.innerHTML = '<i class="fas fa-heart"></i> إزالة من المفضلة';
                    detailFavoriteBtn.classList.add('active');
                    detailFavoriteBtn.onclick = () => removeFromFavorites(propertyId);
                } else {
                    detailFavoriteBtn.innerHTML = '<i class="fas fa-heart"></i> حفظ العقار';
                    detailFavoriteBtn.classList.remove('active');
                    detailFavoriteBtn.onclick = () => addToFavorites(propertyId);
                }
            }
        }

        // Function to show user's favorite properties
        async function showFavorites() {
            if (!currentUser) {
                alert('يرجى تسجيل الدخول لعرض عقاراتك المفضلة');
                showModal('login-modal');
                return;
            }
            
            // Hide other pages
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('properties-listing').style.display = 'none';
            document.getElementById('rent-listing').style.display = 'none';
            document.getElementById('property-detail').style.display = 'none';
            document.getElementById('contact-page').style.display = 'none';
            
            // Show favorites page
            document.getElementById('favorites-page').style.display = 'block';
            
            // Update breadcrumb
            document.getElementById('breadcrumb-list').innerHTML = `
                <li><a onclick="showHomePage()">الرئيسية</a></li>
                <li>عقاراتي المفضلة</li>
            `;
            
            try {
                // Get user's favorites with property details
                const { data, error } = await supabase
                    .from('favorites')
                    .select(`
                        id,
                        property_id,
                        properties (
                            id,
                            title,
                            price,
                            type,
                            area,
                            bedrooms,
                            bathrooms,
                            city,
                            district,
                            image_urls,
                            property_type
                        )
                    `)
                    .eq('user_id', currentUser.id);
                    
                if (error) {
                    alert('خطأ في جلب العقارات المفضلة: ' + error.message);
                    return;
                }
                
                const favoritesGrid = document.getElementById('favorites-grid');
                favoritesGrid.innerHTML = '';
                
                if (!data || data.length === 0) {
                    favoritesGrid.innerHTML = `
                        <div class="no-results" style="grid-column: 1/-1;">
                            <i class="fas fa-heart"></i>
                            <h3>لا توجد عقارات مفضلة</h3>
                            <p>لم تقم بحفظ أي عقار في قائمتك المفضلة بعد.</p>
                            <button class="btn btn-primary" onclick="showHomePage()" style="margin-top: 15px;">
                                تصفح العقارات
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // Display favorite properties
                data.forEach(fav => {
                    if (!fav.properties) return; // Skip if property data is missing
                    
                    const property = fav.properties;
                    const imageUrl = property.image_urls && property.image_urls.length > 0 
                        ? property.image_urls[0] 
                        : 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80';
                    
                    const propertyCard = document.createElement('div');
                    propertyCard.className = 'property-card';
                    propertyCard.setAttribute('data-property-id', property.id);
                    propertyCard.innerHTML = `
                        <div class="property-image">
                            <img src="${imageUrl}" alt="${property.title}">
                            <div class="property-badge badge-${property.type}">${property.type === 'sale' ? 'للبيع' : 'للإيجار'}</div>
                        </div>
                        <div class="property-content">
                            <h3 class="property-card-title">${property.title}</h3>
                            <div class="property-card-price price-${property.type}">
                                ${property.price.toLocaleString()} ريال ${property.type === 'rent' ? '/ شهرياً' : ''}
                            </div>
                            <div class="property-card-address">
                                <i class="fas fa-map-marker-alt"></i>
                                ${property.district}، ${property.city}
                            </div>
                            <div class="property-card-features">
                                <div class="property-feature">
                                    <i class="fas fa-ruler-combined"></i>
                                    <span>${property.area} م²</span>
                                </div>
                                ${property.bedrooms ? `
                                <div class="property-feature">
                                    <i class="fas fa-bed"></i>
                                    <span>${property.bedrooms} غرف</span>
                                </div>
                                ` : ''}
                                ${property.bathrooms ? `
                                <div class="property-feature">
                                    <i class="fas fa-bath"></i>
                                    <span>${property.bathrooms} حمامات</span>
                                </div>
                                ` : ''}
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="view-details-btn" onclick="showPropertyDetails('${property.id}', '${property.type}')" style="flex: 1;">
                                    عرض التفاصيل
                                </button>
                                <button class="btn-favorite active" onclick="removeFromFavorites('${property.id}')" style="width: auto; padding: 10px 15px;">
                                    <i class="fas fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    favoritesGrid.appendChild(propertyCard);
                });
            } catch (err) {
                alert('حدث خطأ: ' + err.message);
            }
        }
        
        // Function to fetch properties from Supabase
        async function fetchProperties(type = null) {
            let query = supabase.from('properties').select('*');
            
            if (type) {
                query = query.eq('type', type);
            }
            
            const { data, error } = await query;
            
            if (error) {
                console.error('Error fetching properties:', error);
                return [];
            }
            
            return data || [];
        }
        
        // Function to create property card HTML
        function createPropertyCard(property) {
            const imageUrl = property.image_urls && property.image_urls.length > 0 
                ? property.image_urls[0] 
                : 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80';
            
            const propertyCard = document.createElement('div');
            propertyCard.className = 'property-card';
            propertyCard.setAttribute('data-property-id', property.id);
            propertyCard.innerHTML = `
                <div class="property-image">
                    <img src="${imageUrl}" alt="${property.title}">
                    <div class="property-badge badge-${property.type}">${property.type === 'sale' ? 'للبيع' : 'للإيجار'}</div>
                </div>
                <div class="property-content">
                    <h3 class="property-card-title">${property.title}</h3>
                    <div class="property-card-price price-${property.type}">
                        ${property.price.toLocaleString()} ريال ${property.type === 'rent' ? '/ شهرياً' : ''}
                    </div>
                    <div class="property-card-address">
                        <i class="fas fa-map-marker-alt"></i>
                        ${property.district}، ${property.city}
                    </div>
                    <div class="property-card-features">
                        <div class="property-feature">
                            <i class="fas fa-ruler-combined"></i>
                            <span>${property.area} م²</span>
                        </div>
                        ${property.bedrooms ? `
                        <div class="property-feature">
                            <i class="fas fa-bed"></i>
                            <span>${property.bedrooms} غرف</span>
                        </div>
                        ` : ''}
                        ${property.bathrooms ? `
                        <div class="property-feature">
                            <i class="fas fa-bath"></i>
                            <span>${property.bathrooms} حمامات</span>
                        </div>
                        ` : ''}
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="view-details-btn" onclick="showPropertyDetails('${property.id}', '${property.type}')" style="flex: 1;">
                            عرض التفاصيل
                        </button>
                        <button class="btn-favorite" onclick="addToFavorites('${property.id}')" style="width: auto; padding: 10px 15px;">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>
                </div>
            `;
            
            return propertyCard;
        }
        
        // Function to show home page
        function showHomePage() {
            document.getElementById('home-page').style.display = 'block';
            document.getElementById('properties-listing').style.display = 'none';
            document.getElementById('rent-listing').style.display = 'none';
            document.getElementById('property-detail').style.display = 'none';
            document.getElementById('contact-page').style.display = 'none';
            document.getElementById('favorites-page').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('sale-search-results').style.display = 'none';
            document.getElementById('rent-search-results').style.display = 'none';
            
            // Reset breadcrumb
            document.getElementById('breadcrumb-list').innerHTML = `
                <li><a onclick="showHomePage()">الرئيسية</a></li>
            `;
            
            // Load properties
            loadHomePageProperties();
        }
        
        // Function to load properties for home page
        async function loadHomePageProperties() {
            const propertiesGrid = document.getElementById('home-properties-grid');
            propertiesGrid.innerHTML = '';
            
            // Fetch properties from Supabase
            const properties = await fetchProperties();
            
            // Display properties
            properties.forEach(property => {
                const propertyCard = createPropertyCard(property);
                propertiesGrid.appendChild(propertyCard);
            });
        }
        
        // Function to show properties listing (for sale)
        async function showPropertiesListing() {
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('properties-listing').style.display = 'block';
            document.getElementById('rent-listing').style.display = 'none';
            document.getElementById('property-detail').style.display = 'none';
            document.getElementById('contact-page').style.display = 'none';
            document.getElementById('favorites-page').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('sale-search-results').style.display = 'none';
            document.getElementById('rent-search-results').style.display = 'none';
            
            currentListingType = 'sale';
            
            // Update breadcrumb
            document.getElementById('breadcrumb-list').innerHTML = `
                <li><a onclick="showHomePage()">الرئيسية</a></li>
                <li><a onclick="showPropertiesListing()">عقارات للبيع</a></li>
            `;
            
            // Load properties
            const propertiesGrid = document.getElementById('sale-properties-grid');
            propertiesGrid.innerHTML = '';
            
            // Fetch properties from Supabase
            const properties = await fetchProperties('sale');
            
            // Display properties
            properties.forEach(property => {
                const propertyCard = createPropertyCard(property);
                propertiesGrid.appendChild(propertyCard);
            });
        }
        
        // Function to show rent properties listing
        async function showRentListing() {
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('properties-listing').style.display = 'none';
            document.getElementById('rent-listing').style.display = 'block';
            document.getElementById('property-detail').style.display = 'none';
            document.getElementById('contact-page').style.display = 'none';
            document.getElementById('favorites-page').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('sale-search-results').style.display = 'none';
            document.getElementById('rent-search-results').style.display = 'none';
            
            currentListingType = 'rent';
            
            // Update breadcrumb
            document.getElementById('breadcrumb-list').innerHTML = `
                <li><a onclick="showHomePage()">الرئيسية</a></li>
                <li><a onclick="showRentListing()">عقارات للإيجار</a></li>
            `;
            
            // Load properties
            const propertiesGrid = document.getElementById('rent-properties-grid');
            propertiesGrid.innerHTML = '';
            
            // Fetch properties from Supabase
            const properties = await fetchProperties('rent');
            
            // Display properties
            properties.forEach(property => {
                const propertyCard = createPropertyCard(property);
                propertiesGrid.appendChild(propertyCard);
            });
        }
        
        // Function to show contact page
        function showContactPage() {
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('properties-listing').style.display = 'none';
            document.getElementById('rent-listing').style.display = 'none';
            document.getElementById('property-detail').style.display = 'none';
            document.getElementById('contact-page').style.display = 'block';
            document.getElementById('favorites-page').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('sale-search-results').style.display = 'none';
            document.getElementById('rent-search-results').style.display = 'none';
            
            // Update breadcrumb
            document.getElementById('breadcrumb-list').innerHTML = `
                <li><a onclick="showHomePage()">الرئيسية</a></li>
                <li><a onclick="showContactPage()">اتصل بنا</a></li>
            `;
            
            // Initialize contact map
            initContactMap();
        }
        
        // Function to filter properties on home page
        function filterProperties(type) {
            const tabs = document.querySelectorAll('.category-tab');
            const properties = document.querySelectorAll('#home-properties-grid .property-card');
            
            // Update active tab
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide properties based on filter
            properties.forEach(property => {
                const propertyType = property.getAttribute('data-type');
                if (type === 'all' || propertyType === type) {
                    property.style.display = 'block';
                } else {
                    property.style.display = 'none';
                }
            });
        }
        
        // Function to perform search on home page
        async function performSearch() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
            
            if (searchTerm === '') {
                document.getElementById('search-results').style.display = 'none';
                return;
            }
            
            // Fetch properties from Supabase
            const properties = await fetchProperties();
            const resultsContainer = document.getElementById('search-results-container');
            resultsContainer.innerHTML = '';
            
            let foundResults = false;
            
            properties.forEach(property => {
                const title = property.title.toLowerCase();
                const address = `${property.district}، ${property.city}`.toLowerCase();
                const propertyType = (property.property_type || '').toLowerCase();
                
                // Check if search term matches any property attribute
                if (title.includes(searchTerm) || 
                    address.includes(searchTerm) || 
                    propertyType.includes(searchTerm)) {
                    
                    // Create property card and add to results
                    const propertyCard = createPropertyCard(property);
                    resultsContainer.appendChild(propertyCard);
                    foundResults = true;
                }
            });
            
            // Show search results section
            document.getElementById('search-results').style.display = 'block';
            
            // Show no results message if no properties found
            if (!foundResults) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>لا توجد نتائج</h3>
                        <p>لم يتم العثور على عقارات تطابق بحثك. يرجى تجربة كلمات أخرى.</p>
                    </div>
                `;
            }
            
            // Scroll to search results
            document.getElementById('search-results').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Function to perform search on sale properties page
        async function performSaleSearch() {
            const searchTerm = document.getElementById('sale-search-input').value.toLowerCase().trim();
            
            if (searchTerm === '') {
                document.getElementById('sale-search-results').style.display = 'none';
                // Show all properties if search term is empty
                showPropertiesListing();
                return;
            }
            
            // Fetch properties from Supabase
            const properties = await fetchProperties('sale');
            const resultsContainer = document.getElementById('sale-search-results-container');
            resultsContainer.innerHTML = '';
            
            let foundResults = false;
            
            properties.forEach(property => {
                const title = property.title.toLowerCase();
                const address = `${property.district}، ${property.city}`.toLowerCase();
                const propertyType = (property.property_type || '').toLowerCase();
                
                // Check if search term matches any property attribute
                if (title.includes(searchTerm) || 
                    address.includes(searchTerm) || 
                    propertyType.includes(searchTerm)) {
                    
                    // Create property card and add to results
                    const propertyCard = createPropertyCard(property);
                    resultsContainer.appendChild(propertyCard);
                    foundResults = true;
                }
            });
            
            // Show search results section
            document.getElementById('sale-search-results').style.display = 'block';
            
            // Show no results message if no properties found
            if (!foundResults) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>لا توجد نتائج</h3>
                        <p>لم يتم العثور على عقارات تطابق بحثك. يرجى تجربة كلمات أخرى.</p>
                    </div>
                `;
            }
            
            // Scroll to search results
            document.getElementById('sale-search-results').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Function to perform search on rent properties page
        async function performRentSearch() {
            const searchTerm = document.getElementById('rent-search-input').value.toLowerCase().trim();
            
            if (searchTerm === '') {
                document.getElementById('rent-search-results').style.display = 'none';
                // Show all properties if search term is empty
                showRentListing();
                return;
            }
            
            // Fetch properties from Supabase
            const properties = await fetchProperties('rent');
            const resultsContainer = document.getElementById('rent-search-results-container');
            resultsContainer.innerHTML = '';
            
            let foundResults = false;
            
            properties.forEach(property => {
                const title = property.title.toLowerCase();
                const address = `${property.district}، ${property.city}`.toLowerCase();
                const propertyType = (property.property_type || '').toLowerCase();
                
                // Check if search term matches any property attribute
                if (title.includes(searchTerm) || 
                    address.includes(searchTerm) || 
                    propertyType.includes(searchTerm)) {
                    
                    // Create property card and add to results
                    const propertyCard = createPropertyCard(property);
                    resultsContainer.appendChild(propertyCard);
                    foundResults = true;
                }
            });
            
            // Show search results section
            document.getElementById('rent-search-results').style.display = 'block';
            
            // Show no results message if no properties found
            if (!foundResults) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>لا توجد نتائج</h3>
                        <p>لم يتم العثور على عقارات تطابق بحثك. يرجى تجربة كلمات أخرى.</p>
                    </div>
                `;
            }
            
            // Scroll to search results
            document.getElementById('rent-search-results').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Function to show property details and hide listing
        async function showPropertyDetails(propertyId, propertyType) {
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('properties-listing').style.display = 'none';
            document.getElementById('rent-listing').style.display = 'none';
            document.getElementById('property-detail').style.display = 'block';
            document.getElementById('contact-page').style.display = 'none';
            document.getElementById('favorites-page').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
            document.getElementById('sale-search-results').style.display = 'none';
            document.getElementById('rent-search-results').style.display = 'none';
            
            currentPropertyId = propertyId;
            
            // Fetch property from Supabase
            const { data: property, error } = await supabase
                .from('properties')
                .select('*')
                .eq('id', propertyId)
                .maybeSingle(); // Use maybeSingle instead of single to avoid error if not found
                
            if (error || !property) {
                console.error('Error fetching property:', error || 'Property not found');
                alert('عذراً، لم يتم العثور على العقار المطلوب');
                goBackToListing();
                return;
            }
            
            // Update property details
            document.getElementById('detail-title').textContent = property.title;
            document.getElementById('detail-price').textContent = `${property.price.toLocaleString()} ريال ${property.type === 'rent' ? '/ شهرياً' : ''}`;
            document.getElementById('detail-address').textContent = `${property.district}، ${property.city}، المملكة العربية السعودية`;
            document.getElementById('detail-description').textContent = property.description || 'لا يوجد وصف متاح';
            
            // Update owner information
            document.getElementById('owner-name').textContent = property.owner_name || 'غير محدد';
            document.getElementById('owner-phone').textContent = property.owner_phone || 'غير متوفر';
            document.getElementById('owner-email').textContent = property.owner_email || 'غير متوفر';
            document.getElementById('owner-avatar-img').src = property.owner_avatar || 'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80';
            
            // Reset phone number visibility
            phoneNumberVisible = false;
            document.getElementById('owner-phone').style.filter = 'blur(4px)';
            document.getElementById('owner-phone').style.userSelect = 'none';
            
            // Update badge
            const badgeElement = document.getElementById('detail-badge');
            if (propertyType === 'sale') {
                badgeElement.textContent = 'للبيع';
                badgeElement.className = 'image-badge badge-sale-detail';
                document.getElementById('detail-price').className = 'property-price price-sale-detail';
            } else {
                badgeElement.textContent = 'للإيجار';
                badgeElement.className = 'image-badge badge-rent-detail';
                document.getElementById('detail-price').className = 'property-price price-rent-detail';
            }
            
            // Update property features
            const featuresContainer = document.querySelector('.property-features');
            featuresContainer.innerHTML = `
                <div class="feature">
                    <i class="fas fa-ruler-combined"></i>
                    <div>
                        <span class="feature-value">${property.area} م²</span>
                        <span class="feature-label">المساحة</span>
                    </div>
                </div>
                ${property.bedrooms ? `
                <div class="feature">
                    <i class="fas fa-bed"></i>
                    <div>
                        <span class="feature-value">${property.bedrooms}</span>
                        <span class="feature-label">غرف نوم</span>
                    </div>
                </div>
                ` : ''}
                ${property.bathrooms ? `
                <div class="feature">
                    <i class="fas fa-bath"></i>
                    <div>
                        <span class="feature-value">${property.bathrooms}</span>
                        <span class="feature-label">حمامات</span>
                    </div>
                </div>
                ` : ''}
                ${property.parking ? `
                <div class="feature">
                    <i class="fas fa-car"></i>
                    <div>
                        <span class="feature-value">${property.parking}</span>
                        <span class="feature-label">مواقف سيارات</span>
                    </div>
                </div>
                ` : ''}
                ${property.floors ? `
                <div class="feature">
                    <i class="fas fa-building"></i>
                    <div>
                        <span class="feature-value">${property.floors}</span>
                        <span class="feature-label">عدد الأدوار</span>
                    </div>
                </div>
                ` : ''}
                ${property.year_built ? `
                <div class="feature">
                    <i class="fas fa-calendar-alt"></i>
                    <div>
                        <span class="feature-value">${property.year_built}</span>
                        <span class="feature-label">سنة البناء</span>
                    </div>
                </div>
                ` : ''}
            `;
            
            // Update amenities
            const amenitiesContainer = document.querySelector('.amenities');
            amenitiesContainer.innerHTML = '';
            
            if (property.features && Array.isArray(property.features) && property.features.length > 0) {
                property.features.forEach(feature => {
                    const amenity = document.createElement('div');
                    amenity.className = 'amenity';
                    amenity.innerHTML = `
                        <i class="fas fa-check-circle"></i>
                        <span>${feature}</span>
                    `;
                    amenitiesContainer.appendChild(amenity);
                });
            } else {
                amenitiesContainer.innerHTML = '<p>لا توجد مرافق متوفرة</p>';
            }
            
            // Update gallery images
            const mainImage = document.getElementById('main-image');
            const thumbnails = document.querySelectorAll('.thumbnail img');
            
            if (property.image_urls && Array.isArray(property.image_urls) && property.image_urls.length > 0) {
                mainImage.src = property.image_urls[0];
                
                // Update thumbnails
                for (let i = 0; i < Math.min(3, property.image_urls.length); i++) {
                    if (thumbnails[i]) {
                        thumbnails[i].src = property.image_urls[i];
                        thumbnails[i].parentElement.setAttribute('onclick', `changeImage('${property.image_urls[i]}')`);
                    }
                }
            }
            
            // Check if property is in user's favorites
            const isFavorite = await checkIfFavorite(propertyId);
            updateFavoriteButton(propertyId, isFavorite);
            
            // Update breadcrumb
            if (propertyType === 'sale') {
                document.getElementById('breadcrumb-list').innerHTML = `
                    <li><a onclick="showHomePage()">الرئيسية</a></li>
                    <li><a onclick="showPropertiesListing()">عقارات للبيع</a></li>
                    <li>تفاصيل العقار</li>
                `;
            } else {
                document.getElementById('breadcrumb-list').innerHTML = `
                    <li><a onclick="showHomePage()">الرئيسية</a></li>
                    <li><a onclick="showRentListing()">عقارات للإيجار</a></li>
                    <li>تفاصيل العقار</li>
                `;
            }
            
            // Initialize map
            initMap();
        }
        
        // Function to go back to listing
        function goBackToListing() {
            if (currentListingType === 'sale') {
                showPropertiesListing();
            } else if (currentListingType === 'rent') {
                showRentListing();
            } else {
                showHomePage();
            }
        }
        
        // Function to change main image in gallery
        function changeImage(src) {
            document.getElementById('main-image').src = src;
        }
        
        // Function to show/hide phone number
        function showPhoneNumber() {
            const phoneElement = document.getElementById('owner-phone');
            if (!phoneNumberVisible) {
                phoneElement.style.filter = 'none';
                phoneElement.style.userSelect = 'text';
                phoneNumberVisible = true;
            }
        }
        
        // Function to open contact modal
        function openContactModal() {
            document.getElementById('contact-modal').style.display = 'flex';
        }
        
        // Function to close contact modal
        function closeContactModal() {
            document.getElementById('contact-modal').style.display = 'none';
        }
        
        // Initialize map for property details
        function initMap() {
            // Check if map container exists
            if (document.getElementById('property-map')) {
                // Create a map centered on Riyadh
                var map = L.map('property-map').setView([24.7136, 46.6753], 15);
                
                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                
                // Add a marker for the property
                L.marker([24.7136, 46.6753])
                    .addTo(map)
                    .bindPopup('عقار في الرياض')
                    .openPopup();
            }
        }
        
        // Initialize map for contact page
        function initContactMap() {
            // Check if map container exists
            if (document.getElementById('contact-map')) {
                // Create a map centered on Riyadh
                var map = L.map('contact-map').setView([24.7136, 46.6753], 13);
                
                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                
                // Add a marker for the office
                L.marker([24.7136, 46.6753])
                    .addTo(map)
                    .bindPopup('مكتب عقارك الرئيسي')
                    .openPopup();
            }
        }
        
        // Close modal if clicked outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
        
        // Add event listener for Enter key on search inputs
        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        document.getElementById('sale-search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSaleSearch();
            }
        });
        
        document.getElementById('rent-search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performRentSearch();
            }
        });
        
        // Initialize the page
        window.onload = function() {
            // Show home page by default
            showHomePage();
            
            // Check if user is logged in
            checkUserSession();
            
            // Set up auth state change listener
            supabase.auth.onAuthStateChange((event, session) => {
                if (event === 'SIGNED_IN') {
                    currentUser = session.user;
                    document.getElementById('auth-buttons').style.display = 'none';
                    document.getElementById('user-info').style.display = 'flex';
                    document.getElementById('user-name').textContent = `مرحباً، ${currentUser.name}`;
                    
                    // Ensure user has a profile
                    ensureUserProfile(currentUser);
                } else if (event === 'SIGNED_OUT') {
                    currentUser = null;
                    document.getElementById('auth-buttons').style.display = 'flex';
                    document.getElementById('user-info').style.display = 'none';
                } else if (event === 'USER_UPDATED') {
                    // This event is triggered when email is confirmed
                    if (session && session.user && session.user.email_confirmed_at) {
                        currentUser = session.user;
                        document.getElementById('auth-buttons').style.display = 'none';
                        document.getElementById('user-info').style.display = 'flex';
                        document.getElementById('user-name').textContent = `مرحباً، ${currentUser.email}`;
                        alert('تم تأكيد بريدك الإلكتروني بنجاح! يمكنك الآن تسجيل الدخول.');
                    }
                }
            });
        }
    </script>
</body>
</html>
